
# Input and Output File Paths
$inputFile = "C:\Path\To\accounts.txt"  # Update this path
$outputFile = "C:\Path\To\AD_OU_Report.csv"  # Update this path

# Check if input file exists
if (-Not (Test-Path $inputFile)) {
    Write-Host "Input file not found!"
    exit
}

# Initialize an array to store results
$results = @()

# Read usernames from the input file
$users = Get-Content $inputFile

foreach ($user in $users) {
    # Get user details from AD
    $adUser = Get-ADUser -Identity $user -Properties DistinguishedName -ErrorAction SilentlyContinue

    if ($adUser) {
        # Extract OU from DistinguishedName
        $ou = ($adUser.DistinguishedName -replace '^CN=.*?,','')

        # Store results in an object
        $results += [PSCustomObject]@{
            Username = $user
            OU = $ou
        }
    } else {
        # Store not found users
        $results += [PSCustomObject]@{
            Username = $user
            OU = "Not Found"
        }
    }
}

# Export results to CSV
$results | Export-Csv -Path $outputFile -NoTypeInformation

Write-Host "OU information exported to $outputFile"










# Input and Output File Paths
$inputFile = "C:\Path\To\accounts.txt"  # Update this path
$outputFile = "C:\Path\To\AD_User_Report.csv"  # Update this path

# Check if input file exists
if (-Not (Test-Path $inputFile)) {
    Write-Host "Input file not found!"
    exit
}

# Initialize an array to store results
$results = @()

# Read SamAccountNames from the input file
$users = Get-Content $inputFile

foreach ($user in $users) {
    # Get user details from AD
    $adUser = Get-ADUser -Identity $user -Properties DistinguishedName, SamAccountName, Name, UserPrincipalName, Enabled, Mail, LastLogonDate, Modified -ErrorAction SilentlyContinue

    if ($adUser) {
        # Extract OU from DistinguishedName
        $ou = ($adUser.DistinguishedName -replace '^CN=.*?,','')

        # Store results in an object
        $results += [PSCustomObject]@{
            SamAccountName   = $adUser.SamAccountName
            Name             = $adUser.Name
            UserPrincipalName = $adUser.UserPrincipalName
            Enabled          = $adUser.Enabled
            Mail             = $adUser.Mail
            LastLogon        = $adUser.LastLogonDate
            LastModified     = $adUser.Modified
            OU               = $ou
        }
    } else {
        # Store not found users
        $results += [PSCustomObject]@{
            SamAccountName   = $user
            Name             = "Not Found"
            UserPrincipalName = "Not Found"
            Enabled          = "Not Found"
            Mail             = "Not Found"
            LastLogon        = "Not Found"
            LastModified     = "Not Found"
            OU               = "Not Found"
        }
    }
}

# Export results to CSV
$results | Export-Csv -Path $outputFile -NoTypeInformation

Write-Host "User details exported to $outputFile"







# Input and Output File Paths
$inputFile = "C:\Path\To\accounts.txt"  # Update this path
$outputFile = "C:\Path\To\AD_User_Report.csv"  # Update this path

# Check if input file exists
if (-Not (Test-Path $inputFile)) {
    Write-Host "Input file not found!"
    exit
}

# Initialize an array to store results
$results = @()

# Read SamAccountNames from the input file
$users = Get-Content $inputFile

foreach ($user in $users) {
    # Get user details from AD
    $adUser = Get-ADUser -Identity $user -Properties DistinguishedName, SamAccountName, Name, UserPrincipalName, Enabled, Mail, LastLogonDate, Modified, PasswordLastSet -ErrorAction SilentlyContinue

    if ($adUser) {
        # Extract OU from DistinguishedName
        $ou = ($adUser.DistinguishedName -replace '^CN=.*?,','')

        # Convert PasswordLastSet to human-readable format
        $passwordLastSet = if ($adUser.PasswordLastSet -ne $null) { 
            [datetime]::FromFileTimeUtc($adUser.PasswordLastSet).ToString("yyyy-MM-dd HH:mm:ss") 
        } else { 
            "Never Set" 
        }

        # Store results in an object
        $results += [PSCustomObject]@{
            SamAccountName    = $adUser.SamAccountName
            Name              = $adUser.Name
            UserPrincipalName = $adUser.UserPrincipalName
            Enabled           = $adUser.Enabled
            Mail              = $adUser.Mail
            LastLogon         = $adUser.LastLogonDate
            LastModified      = $adUser.Modified
            PasswordLastSet   = $passwordLastSet
            OU                = $ou
        }
    } else {
        # Store not found users
        $results += [PSCustomObject]@{
            SamAccountName    = $user
            Name              = "Not Found"
            UserPrincipalName = "Not Found"
            Enabled           = "Not Found"
            Mail              = "Not Found"
            LastLogon         = "Not Found"
            LastModified      = "Not Found"
            PasswordLastSet   = "Not Found"
            OU                = "Not Found"
        }
    }
}

# Export results to CSV
$results | Export-Csv -Path $outputFile -NoTypeInformation

Write-Host "User details exported to $outputFile"













# Prompt for the AD object name
$ADObjectName = Read-Host "Enter the SAMAccountName of the AD object"

# Get the distinguished name (DN) of the AD object
$ADObject = Get-ADUser -Identity $ADObjectName -Properties DistinguishedName | Select-Object -ExpandProperty DistinguishedName

if ($ADObject) {
    # Get the security descriptor of the AD object
    $Acl = Get-Acl -Path "AD:$ADObject"

    # Check inheritance status
    if ($Acl.AreAccessRulesProtected -eq $false) {
        $Result = "Inheritance is ENABLED for $ADObject"
    } else {
        $Result = "Inheritance is DISABLED for $ADObject"
    }

    # Output file path
    $OutputFile = "C:\Temp\AD_Inheritance_Check.txt"

    # Write result to file
    $Result | Out-File -FilePath $OutputFile -Append
    Write-Host "Result saved to $OutputFile"
} else {
    Write-Host "AD object not found!"
}
